{"ast":null,"code":"import _objectSpread from\"/Users/dannylee/git/ttp-live/ttp-live-frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _toConsumableArray from\"/Users/dannylee/git/ttp-live/ttp-live-frontend/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _classCallCheck from\"/Users/dannylee/git/ttp-live/ttp-live-frontend/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/dannylee/git/ttp-live/ttp-live-frontend/node_modules/@babel/runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"/Users/dannylee/git/ttp-live/ttp-live-frontend/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"/Users/dannylee/git/ttp-live/ttp-live-frontend/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _inherits from\"/Users/dannylee/git/ttp-live/ttp-live-frontend/node_modules/@babel/runtime/helpers/esm/inherits\";import React,{Component}from'react';import axios from'axios';import{BrowserRouter,Switch,Route}from'react-router-dom';import Home from'./components/Home';import Login from'./components/registrations/Login';import Signup from'./components/registrations/Signup';var App=/*#__PURE__*/function(_Component){_inherits(App,_Component);function App(props){var _this;_classCallCheck(this,App);_this=_possibleConstructorReturn(this,_getPrototypeOf(App).call(this,props));_this.setMode=function(modeText){_this.setState({mode:modeText});};_this.updateUser=function(user){_this.setState({user:user});};_this.updateStocks=function(stock,latestPrice){_this.setState({stocks:[].concat(_toConsumableArray(_this.state.stocks),[_objectSpread({},stock,{current_price:latestPrice})])});};_this.loginStatus=function(){axios.get('https://ttp-live-backend.herokuapp.com/logged_in',{withCredentials:true}).then(function(response){if(response.data.logged_in){_this.handleLogin(response.data);}else{_this.handleLogout();}}).catch(function(error){console.log('api errors:',error);});};_this.handleLogin=function(data){_this.setState(function(prevState,props){return{isLoggedIn:true,user:data.user,mode:'portfolio'};});if(data.user){_this.getUserStocks(data.user.id);}};_this.getUserStocks=function(id){fetch(\"https://ttp-live-backend.herokuapp.com/users/\".concat(id)).then(function(resp){return resp.json();}).then(function(json){_this.setState(function(prevState,props){return{stocks:json.stocks,portfolioCost:json.portfolio_cost,portfolioCurrentValue:json.portfolio_current_value};});var symbolList=json.stocks.map(function(s){return s.symbol;}).join(',');axios.get(\"https://sandbox.iexapis.com/stable/stock/market/batch?symbols=\".concat(symbolList,\"&types=ohlc&token=Tpk_f60d00f3b3774527b14ddc2510d54b18\")).then(function(response){var _loop=function _loop(){// response.data[key].ohlc.open.price is the number we're looking for\nvar k=key;// assigning k to key to clear 'no-loop-func' eslint \nvar stockInState=_this.state.stocks.find(function(s){return s.symbol===k;});// stock obj we are iterating on\nvar filteredState=_this.state.stocks.filter(function(s){return s.symbol!==k;});// all others in the stocks array\nvar openPrice=response.data[key].ohlc.open.price;// the open price\n// set the state, using spread oeprator to add a new value to stock obj\n_this.setState({stocks:[].concat(_toConsumableArray(filteredState),[_objectSpread({},stockInState,{openPrice:openPrice})])});};// response contains OHLC data for each stock in our users portfolio\nfor(var key in response.data){_loop();}});});};_this.handleLogout=function(){_this.setState({isLoggedIn:false,user:{}});};_this.state={loading:true,isLoggedIn:false,user:{},mode:'',stocks:[],portfolioCost:0,portfolioCurrentValue:0};return _this;}_createClass(App,[{key:\"componentDidMount\",value:function componentDidMount(){this.loginStatus();}},{key:\"render\",value:function render(){var _this2=this;return React.createElement(\"div\",{id:\"wrapper\"},React.createElement(BrowserRouter,null,React.createElement(Switch,null,React.createElement(Route,{exact:true,path:\"/login\",render:function render(props){return React.createElement(Login,Object.assign({},props,{handleLogin:_this2.handleLogin,loggedInStatus:_this2.state.isLoggedIn}));}}),React.createElement(Route,{exact:true,path:\"/signup\",render:function render(props){return React.createElement(Signup,Object.assign({},props,{handleLogin:_this2.handleLogin,loggedInStatus:_this2.state.isLoggedIn}));}}),React.createElement(Route,{path:\"/\",render:function render(props){return React.createElement(Home,Object.assign({},props,_this2.state,{updateUser:_this2.updateUser,updateStocks:_this2.updateStocks,handleLogout:_this2.handleLogout,userobj:_this2.state.user,setMode:_this2.setMode,modeStatus:_this2.state.mode,loggedInStatus:_this2.state.isLoggedIn}));}}))));}}]);return App;}(Component);export default App;","map":{"version":3,"sources":["/Users/dannylee/git/ttp-live/ttp-live-frontend/src/App.js"],"names":["React","Component","axios","BrowserRouter","Switch","Route","Home","Login","Signup","App","props","setMode","modeText","setState","mode","updateUser","user","updateStocks","stock","latestPrice","stocks","state","current_price","loginStatus","get","withCredentials","then","response","data","logged_in","handleLogin","handleLogout","catch","error","console","log","prevState","isLoggedIn","getUserStocks","id","fetch","resp","json","portfolioCost","portfolio_cost","portfolioCurrentValue","portfolio_current_value","symbolList","map","s","symbol","join","k","key","stockInState","find","filteredState","filter","openPrice","ohlc","open","price","loading"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport axios from 'axios'\nimport {BrowserRouter, Switch, Route} from 'react-router-dom'\nimport Home from './components/Home'\nimport Login from './components/registrations/Login'\nimport Signup from './components/registrations/Signup'\n\nclass App extends Component {\n  constructor(props) {\n    super(props);\n    this.state = { \n      loading: true, \n      isLoggedIn: false,\n      user: {},\n      mode: '',\n      stocks: [],\n      portfolioCost: 0,\n      portfolioCurrentValue: 0\n    };\n  }\n\n  componentDidMount() {\n    this.loginStatus()\n  }\n\n  setMode = (modeText) => {\n    this.setState({\n      mode: modeText\n    })\n  }\n\n  updateUser = (user) => {\n    this.setState({\n      user: user\n    })\n  }\n\n  updateStocks = (stock, latestPrice) => {\n    this.setState({\n      stocks: [...this.state.stocks, { ...stock, current_price: latestPrice } ]\n    })\n  }\n\n  loginStatus = () => {\n    axios.get('https://ttp-live-backend.herokuapp.com/logged_in', {withCredentials: true})\n    .then(response => {\n      if (response.data.logged_in) {\n        this.handleLogin(response.data)\n      } else {\n        this.handleLogout()\n      }\n    })\n    .catch(error =>{\n      console.log('api errors:', error)\n    })\n  }\n\n  handleLogin = (data) => {\n    this.setState((prevState, props) => ({\n      isLoggedIn: true,\n      user: data.user, \n      mode: 'portfolio'\n    }))\n    if (data.user) {\n      this.getUserStocks(data.user.id)\n    }\n  }\n\n  getUserStocks = (id) => {\n    fetch(`https://ttp-live-backend.herokuapp.com/users/${id}`)\n    .then (resp => resp.json())\n    .then (json => {\n      this.setState((prevState, props) => ({\n        stocks: json.stocks,\n        portfolioCost: json.portfolio_cost,\n        portfolioCurrentValue: json.portfolio_current_value\n      }))\n      \n      let symbolList = json.stocks.map(s => s.symbol).join(',')\n\n      axios.get(`https://sandbox.iexapis.com/stable/stock/market/batch?symbols=${symbolList}&types=ohlc&token=Tpk_f60d00f3b3774527b14ddc2510d54b18`)\n      .then(response => {\n        // response contains OHLC data for each stock in our users portfolio\n\n        for (var key in response.data) {\n          // response.data[key].ohlc.open.price is the number we're looking for\n          let k = key   // assigning k to key to clear 'no-loop-func' eslint \n          let stockInState = this.state.stocks.find(s => s.symbol === k) // stock obj we are iterating on\n          let filteredState = this.state.stocks.filter(s => s.symbol !== k) // all others in the stocks array\n          let openPrice = response.data[key].ohlc.open.price // the open price\n\n          // set the state, using spread oeprator to add a new value to stock obj\n          this.setState({\n            stocks: [...filteredState, { ...stockInState, openPrice: openPrice  } ]\n          })\n        }\n      })\n    })\n  }\n\n  handleLogout = () => {\n    this.setState({\n      isLoggedIn: false,\n      user: {}\n    })\n  }\n\n  render() {\n    return (\n      <div id='wrapper'>\n        <BrowserRouter>\n          <Switch>\n            <Route \n              exact path='/login' \n              render={props => (\n              <Login {...props} handleLogin={this.handleLogin} loggedInStatus={this.state.isLoggedIn}/>\n              )}\n            />\n            <Route \n              exact path='/signup' \n              render={props => (\n              <Signup {...props} handleLogin={this.handleLogin} loggedInStatus={this.state.isLoggedIn}/>\n              )}\n            />\n            <Route \n              path='/' \n              render={props => (\n              <Home {...props} {...this.state} updateUser={this.updateUser} updateStocks={this.updateStocks} handleLogout={this.handleLogout} userobj={this.state.user} setMode={this.setMode} modeStatus={this.state.mode} loggedInStatus={this.state.isLoggedIn}/>\n              )}\n            />\n          </Switch>\n        </BrowserRouter>\n      </div>\n    );\n  }\n}\n\nexport default App;"]},"metadata":{},"sourceType":"module"}